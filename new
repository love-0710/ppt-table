Dim outlookApp, mailItem, fso
Dim subjectLine, currentTime
Dim csvPath, fileStream, txtFile, txtFolderPath, txtFileName, txtFilePath

' === Paths ===
csvPath = "C:\Users\e720312\Documents\scripts\EmailLog.csv"
txtFolderPath = "C:\Users\e720312\Documents\scripts\Test files"

Set fso = CreateObject("Scripting.FileSystemObject")

' === Format Time for Subject (one time only) ===
currentTime = Now
subjectLine = "Test_ABC_" & _
              Day(currentTime) & MonthName(Month(currentTime), True) & Year(currentTime) & "_" & _
              Right("0" & Hour(currentTime), 2) & Right("0" & Minute(currentTime), 2) & Right("0" & Second(currentTime), 2) & _
              IIf(Hour(currentTime) < 12, "AM", "PM")

' === Prepare Email ===
Set outlookApp = CreateObject("Outlook.Application")
Set mailItem = outlookApp.CreateItem(0)

mailItem.To = "receiver@example.com"
mailItem.Subject = subjectLine
mailItem.Body = "Please find the attached document."

' === Create TXT File ===
If Not fso.FolderExists(txtFolderPath) Then
    fso.CreateFolder(txtFolderPath)
End If

txtFileName = subjectLine & ".txt"
txtFilePath = txtFolderPath & "\" & txtFileName

On Error Resume Next
Set txtFile = fso.CreateTextFile(txtFilePath, True)
If Err.Number <> 0 Then
    MsgBox "Failed to create text file: " & Err.Description, vbCritical
    Err.Clear
Else
    txtFile.WriteLine "Performance testing - " & subjectLine
    txtFile.Close
End If
On Error GoTo 0

' === Attach the TXT File to Email ===
mailItem.Attachments.Add txtFilePath

' === Append to CSV ===
If Not fso.FileExists(csvPath) Then
    Set fileStream = fso.CreateTextFile(csvPath, True)
    fileStream.WriteLine "EmailSubject"
    fileStream.Close
End If

Set fileStream = fso.OpenTextFile(csvPath, 8, True) ' 8 = ForAppending
fileStream.WriteLine subjectLine
fileStream.Close

' === Display or Send Email ===
mailItem.Display  ' Change to mailItem.Send to send directly

MsgBox "Email ready, subject logged, and text file created!", 64